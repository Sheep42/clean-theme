"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _jquery=_interopRequireDefault(require("jquery")),_popper=_interopRequireDefault(require("popper.js")),_util=_interopRequireDefault(require("./util"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var NAME="dropdown",VERSION="4.4.1",DATA_KEY="bs.dropdown",EVENT_KEY=".".concat(DATA_KEY),DATA_API_KEY=".data-api",JQUERY_NO_CONFLICT=_jquery.default.fn[NAME],ESCAPE_KEYCODE=27,SPACE_KEYCODE=32,TAB_KEYCODE=9,ARROW_UP_KEYCODE=38,ARROW_DOWN_KEYCODE=40,RIGHT_MOUSE_BUTTON_WHICH=3,REGEXP_KEYDOWN=new RegExp("".concat(ARROW_UP_KEYCODE,"|").concat(ARROW_DOWN_KEYCODE,"|").concat(ESCAPE_KEYCODE)),Event={HIDE:"hide".concat(EVENT_KEY),HIDDEN:"hidden".concat(EVENT_KEY),SHOW:"show".concat(EVENT_KEY),SHOWN:"shown".concat(EVENT_KEY),CLICK:"click".concat(EVENT_KEY),CLICK_DATA_API:"click".concat(EVENT_KEY).concat(DATA_API_KEY),KEYDOWN_DATA_API:"keydown".concat(EVENT_KEY).concat(DATA_API_KEY),KEYUP_DATA_API:"keyup".concat(EVENT_KEY).concat(DATA_API_KEY)},ClassName={DISABLED:"disabled",SHOW:"show",DROPUP:"dropup",DROPRIGHT:"dropright",DROPLEFT:"dropleft",MENURIGHT:"dropdown-menu-right",MENULEFT:"dropdown-menu-left",POSITION_STATIC:"position-static"},Selector={DATA_TOGGLE:'[data-toggle="dropdown"]',FORM_CHILD:".dropdown form",MENU:".dropdown-menu",NAVBAR_NAV:".navbar-nav",VISIBLE_ITEMS:".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)"},AttachmentMap={TOP:"top-start",TOPEND:"top-end",BOTTOM:"bottom-start",BOTTOMEND:"bottom-end",RIGHT:"right-start",RIGHTEND:"right-end",LEFT:"left-start",LEFTEND:"left-end"},Default={offset:0,flip:!0,boundary:"scrollParent",reference:"toggle",display:"dynamic",popperConfig:null},DefaultType={offset:"(number|string|function)",flip:"boolean",boundary:"(string|element)",reference:"(string|element)",display:"string",popperConfig:"(null|object)"},Dropdown=function(){function e(t,n){_classCallCheck(this,e),this._element=t,this._popper=null,this._config=this._getConfig(n),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar(),this._addEventListeners()}return _createClass(e,[{key:"toggle",value:function(){if(!this._element.disabled&&!(0,_jquery.default)(this._element).hasClass(ClassName.DISABLED)){var t=(0,_jquery.default)(this._menu).hasClass(ClassName.SHOW);e._clearMenus(),t||this.show(!0)}}},{key:"show",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!(this._element.disabled||(0,_jquery.default)(this._element).hasClass(ClassName.DISABLED)||(0,_jquery.default)(this._menu).hasClass(ClassName.SHOW))){var n={relatedTarget:this._element},r=_jquery.default.Event(Event.SHOW,n),a=e._getParentFromElement(this._element);if((0,_jquery.default)(a).trigger(r),!r.isDefaultPrevented()){if(!this._inNavbar&&t){if(void 0===_popper.default)throw new TypeError("Bootstrap's dropdowns require Popper.js (https://popper.js.org/)");var o=this._element;"parent"===this._config.reference?o=a:_util.default.isElement(this._config.reference)&&(o=this._config.reference,void 0!==this._config.reference.jquery&&(o=this._config.reference[0])),"scrollParent"!==this._config.boundary&&(0,_jquery.default)(a).addClass(ClassName.POSITION_STATIC),this._popper=new _popper.default(o,this._menu,this._getPopperConfig())}"ontouchstart"in document.documentElement&&0===(0,_jquery.default)(a).closest(Selector.NAVBAR_NAV).length&&(0,_jquery.default)(document.body).children().on("mouseover",null,_jquery.default.noop),this._element.focus(),this._element.setAttribute("aria-expanded",!0),(0,_jquery.default)(this._menu).toggleClass(ClassName.SHOW),(0,_jquery.default)(a).toggleClass(ClassName.SHOW).trigger(_jquery.default.Event(Event.SHOWN,n))}}}},{key:"hide",value:function(){if(!this._element.disabled&&!(0,_jquery.default)(this._element).hasClass(ClassName.DISABLED)&&(0,_jquery.default)(this._menu).hasClass(ClassName.SHOW)){var t={relatedTarget:this._element},n=_jquery.default.Event(Event.HIDE,t),r=e._getParentFromElement(this._element);(0,_jquery.default)(r).trigger(n),n.isDefaultPrevented()||(this._popper&&this._popper.destroy(),(0,_jquery.default)(this._menu).toggleClass(ClassName.SHOW),(0,_jquery.default)(r).toggleClass(ClassName.SHOW).trigger(_jquery.default.Event(Event.HIDDEN,t)))}}},{key:"dispose",value:function(){_jquery.default.removeData(this._element,DATA_KEY),(0,_jquery.default)(this._element).off(EVENT_KEY),this._element=null,this._menu=null,null!==this._popper&&(this._popper.destroy(),this._popper=null)}},{key:"update",value:function(){this._inNavbar=this._detectNavbar(),null!==this._popper&&this._popper.scheduleUpdate()}},{key:"_addEventListeners",value:function(){var e=this;(0,_jquery.default)(this._element).on(Event.CLICK,function(t){t.preventDefault(),t.stopPropagation(),e.toggle()})}},{key:"_getConfig",value:function(e){return e=_objectSpread({},this.constructor.Default,{},(0,_jquery.default)(this._element).data(),{},e),_util.default.typeCheckConfig(NAME,e,this.constructor.DefaultType),e}},{key:"_getMenuElement",value:function(){if(!this._menu){var t=e._getParentFromElement(this._element);t&&(this._menu=t.querySelector(Selector.MENU))}return this._menu}},{key:"_getPlacement",value:function(){var e=(0,_jquery.default)(this._element.parentNode),t=AttachmentMap.BOTTOM;return e.hasClass(ClassName.DROPUP)?(t=AttachmentMap.TOP,(0,_jquery.default)(this._menu).hasClass(ClassName.MENURIGHT)&&(t=AttachmentMap.TOPEND)):e.hasClass(ClassName.DROPRIGHT)?t=AttachmentMap.RIGHT:e.hasClass(ClassName.DROPLEFT)?t=AttachmentMap.LEFT:(0,_jquery.default)(this._menu).hasClass(ClassName.MENURIGHT)&&(t=AttachmentMap.BOTTOMEND),t}},{key:"_detectNavbar",value:function(){return(0,_jquery.default)(this._element).closest(".navbar").length>0}},{key:"_getOffset",value:function(){var e=this,t={};return"function"==typeof this._config.offset?t.fn=function(t){return t.offsets=_objectSpread({},t.offsets,{},e._config.offset(t.offsets,e._element)||{}),t}:t.offset=this._config.offset,t}},{key:"_getPopperConfig",value:function(){var e={placement:this._getPlacement(),modifiers:{offset:this._getOffset(),flip:{enabled:this._config.flip},preventOverflow:{boundariesElement:this._config.boundary}}};return"static"===this._config.display&&(e.modifiers.applyStyle={enabled:!1}),_objectSpread({},e,{},this._config.popperConfig)}}],[{key:"_jQueryInterface",value:function(t){return this.each(function(){var n=(0,_jquery.default)(this).data(DATA_KEY),r="object"===_typeof(t)?t:null;if(n||(n=new e(this,r),(0,_jquery.default)(this).data(DATA_KEY,n)),"string"==typeof t){if(void 0===n[t])throw new TypeError('No method named "'.concat(t,'"'));n[t]()}})}},{key:"_clearMenus",value:function(t){if(!t||t.which!==RIGHT_MOUSE_BUTTON_WHICH&&("keyup"!==t.type||t.which===TAB_KEYCODE))for(var n=[].slice.call(document.querySelectorAll(Selector.DATA_TOGGLE)),r=0,a=n.length;r<a;r++){var o=e._getParentFromElement(n[r]),l=(0,_jquery.default)(n[r]).data(DATA_KEY),u={relatedTarget:n[r]};if(t&&"click"===t.type&&(u.clickEvent=t),l){var s=l._menu;if((0,_jquery.default)(o).hasClass(ClassName.SHOW)&&!(t&&("click"===t.type&&/input|textarea/i.test(t.target.tagName)||"keyup"===t.type&&t.which===TAB_KEYCODE)&&_jquery.default.contains(o,t.target))){var i=_jquery.default.Event(Event.HIDE,u);(0,_jquery.default)(o).trigger(i),i.isDefaultPrevented()||("ontouchstart"in document.documentElement&&(0,_jquery.default)(document.body).children().off("mouseover",null,_jquery.default.noop),n[r].setAttribute("aria-expanded","false"),l._popper&&l._popper.destroy(),(0,_jquery.default)(s).removeClass(ClassName.SHOW),(0,_jquery.default)(o).removeClass(ClassName.SHOW).trigger(_jquery.default.Event(Event.HIDDEN,u)))}}}}},{key:"_getParentFromElement",value:function(e){var t,n=_util.default.getSelectorFromElement(e);return n&&(t=document.querySelector(n)),t||e.parentNode}},{key:"_dataApiKeydownHandler",value:function(t){if((/input|textarea/i.test(t.target.tagName)?!(t.which===SPACE_KEYCODE||t.which!==ESCAPE_KEYCODE&&(t.which!==ARROW_DOWN_KEYCODE&&t.which!==ARROW_UP_KEYCODE||(0,_jquery.default)(t.target).closest(Selector.MENU).length)):REGEXP_KEYDOWN.test(t.which))&&(t.preventDefault(),t.stopPropagation(),!this.disabled&&!(0,_jquery.default)(this).hasClass(ClassName.DISABLED))){var n=e._getParentFromElement(this),r=(0,_jquery.default)(n).hasClass(ClassName.SHOW);if(r||t.which!==ESCAPE_KEYCODE)if(r&&(!r||t.which!==ESCAPE_KEYCODE&&t.which!==SPACE_KEYCODE)){var a=[].slice.call(n.querySelectorAll(Selector.VISIBLE_ITEMS)).filter(function(e){return(0,_jquery.default)(e).is(":visible")});if(0!==a.length){var o=a.indexOf(t.target);t.which===ARROW_UP_KEYCODE&&o>0&&o--,t.which===ARROW_DOWN_KEYCODE&&o<a.length-1&&o++,o<0&&(o=0),a[o].focus()}}else{if(t.which===ESCAPE_KEYCODE){var l=n.querySelector(Selector.DATA_TOGGLE);(0,_jquery.default)(l).trigger("focus")}(0,_jquery.default)(this).trigger("click")}}}},{key:"VERSION",get:function(){return VERSION}},{key:"Default",get:function(){return Default}},{key:"DefaultType",get:function(){return DefaultType}}]),e}();(0,_jquery.default)(document).on(Event.KEYDOWN_DATA_API,Selector.DATA_TOGGLE,Dropdown._dataApiKeydownHandler).on(Event.KEYDOWN_DATA_API,Selector.MENU,Dropdown._dataApiKeydownHandler).on("".concat(Event.CLICK_DATA_API," ").concat(Event.KEYUP_DATA_API),Dropdown._clearMenus).on(Event.CLICK_DATA_API,Selector.DATA_TOGGLE,function(e){e.preventDefault(),e.stopPropagation(),Dropdown._jQueryInterface.call((0,_jquery.default)(this),"toggle")}).on(Event.CLICK_DATA_API,Selector.FORM_CHILD,function(e){e.stopPropagation()}),_jquery.default.fn[NAME]=Dropdown._jQueryInterface,_jquery.default.fn[NAME].Constructor=Dropdown,_jquery.default.fn[NAME].noConflict=function(){return _jquery.default.fn[NAME]=JQUERY_NO_CONFLICT,Dropdown._jQueryInterface};var _default=Dropdown;exports.default=_default;